<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘‘ å¯æ„›æ‰“å­—é­”æ³•æŒ‘æˆ° ğŸ‘‘</title>
    <style>
        /* CSS æ¨£å¼ (ä¿æŒä¸è®Š) */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #FFDAB9 0%, #FFB6C1 50%, #ADD8E6 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
            text-align: center;
            overflow: hidden;
        }

        .game-container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 90%;
            border: 6px solid #FF69B4;
            position: relative;
        }

        h1 {
            color: #C71585;
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px #FFDAB9;
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #F0FFF0;
            border-radius: 10px;
            border: 2px solid #90EE90;
        }
        
        .control-group {
            margin-bottom: 10px;
            display: inline-block;
            margin-right: 20px;
        }

        .controls label, .controls select {
            margin-right: 15px;
            font-weight: bold;
            color: #6A5ACD;
            font-size: 1.1em;
        }
        
        .controls select {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #FFC0CB;
        }

        #target-letter-box {
            background-color: #F0F8FF;
            border: 10px solid #FFC0CB;
            border-radius: 20px;
            padding: 30px 0;
            margin: 20px auto;
            width: 200px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 25px rgba(255, 105, 180, 0.7);
            transition: transform 0.1s, box-shadow 0.3s;
            overflow: hidden;
            position: relative;
        }

        .sparkle-effect {
            box-shadow: 0 0 40px 10px #FFFF00, 0 0 80px 20px #FFD700;
            transform: scale(1.05);
        }

        .shake-effect {
            animation: shake 0.2s ease-in-out;
            box-shadow: 0 0 25px 5px #FF4500;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            25% { transform: translate(-1px, -2px) rotate(-1deg); }
            50% { transform: translate(1px, 2px) rotate(1deg); }
            75% { transform: translate(-1px, -1px) rotate(-1deg); }
            100% { transform: translate(1px, 1px) rotate(0deg); }
        }

        #target-letter {
            font-size: 10em;
            font-weight: bold;
            color: #8A2BE2;
            animation: pulse 1.5s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .info-board {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-top: 20px;
            font-size: 1.1em;
        }
        
        .info-item {
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            margin: 5px;
        }
        
        #data-board {
            background-color: #F0FFFF;
            color: #008B8B;
            border: 2px solid #87CEFA;
        }

        #timer-board {
            background-color: #E6E6FA;
            color: #4B0082;
            border: 2px solid #DDA0DD;
        }
        
        #score-board {
            background-color: #FFE4E1;
            color: #FF1493;
            border: 2px solid #FFB6C1;
        }
        
        .result-detail {
            background-color: #FFF0F5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px dashed #FF69B4;
            font-size: 1.1em;
            text-align: left;
        }
        
        .result-detail strong {
            color: #C71585;
            font-size: 1.2em;
        }

        .end-message {
            color: #C71585;
            font-size: 1.5em;
            margin-top: 20px;
            font-weight: bold;
        }
        
        #star-rewards {
            font-size: 3em;
            margin: 10px 0;
            color: gold;
            text-shadow: 1px 1px 3px #DDA0DD;
        }
        
        #perfect-star {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 15em;
            color: #FFD700;
            text-shadow: 0 0 10px #FF69B4, 0 0 20px #FFD700;
            opacity: 0;
            transition: opacity 1s;
            pointer-events: none;
        }
        
        .show-perfect {
            opacity: 1 !important;
            animation: bounce 0.5s ease-out;
        }
        
        @keyframes bounce {
            0% { transform: translate(-50%, -50%) scale(0.5); }
            70% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        button {
            background-color: #FF69B4;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #FF1493;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0);
            pointer-events: none;
            transition: background-color 0.1s ease-out;
            z-index: 1000;
        }

        .correct-flash {
            background-color: rgba(255, 255, 255, 0.4);
        }
        .wrong-flash {
            background-color: rgba(255, 0, 0, 0.3);
        }

    </style>
</head>
<body>
    
    <div id="flash-overlay"></div>
    
    <div id="perfect-star">â­</div>

    <div class="game-container">
        <h1>ğŸ‘‘ å¯æ„›æ‰“å­—é­”æ³•æŒ‘æˆ° ğŸ‘‘</h1>
        <p>ğŸ’¡ æŒ‘æˆ°é–‹å§‹ï¼è«‹æŒ‰ä¸‹éµç›¤ä¸Šé¡¯ç¤ºçš„å­—å…ƒï¼</p>

        <div class="controls">
            <div class="control-group">
                 <label for="challenge-time">é¸æ“‡æŒ‘æˆ°æ™‚é–“:</label>
                 <select id="challenge-time">
                     <option value="60">60 ç§’ (1 åˆ†é˜)</option>
                     <option value="120">120 ç§’ (2 åˆ†é˜)</option>
                     <option value="300">300 ç§’ (5 åˆ†é˜)</option>
                     <option value="0">ä¸é™æ™‚ (æŒ‰åœæ­¢æ‰åœ)</option>
                 </select>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="include-uppercase" checked> å­—æ¯å¤§å¯« (A-Z)
                </label>
                <label>
                    <input type="checkbox" id="include-lowercase"> å­—æ¯å°å¯« (a-z)
                </label>
                <label>
                    <input type="checkbox" id="include-symbols"> æ•¸å­—/ç¬¦è™Ÿ (1-9!@#)
                </label>
            </div>
        </div>
        
        <button id="start-button">é–‹å§‹é­”æ³•æŒ‘æˆ°</button>
        <button id="stop-button" style="display: none;">åœæ­¢æŒ‘æˆ°</button>

        <div id="target-letter-box">
            <span id="target-letter">A</span>
        </div>

        <div id="message-board"></div>

        <div class="info-board">
            <div id="timer-board" class="info-item">
                æ™‚é–“ï¼š<span id="timer">0</span>
            </div>
            <div id="data-board" class="info-item">
                ç¸½é¡Œæ•¸ï¼š<span id="total-count">0</span> | æº–ç¢ºç‡ï¼š<span id="accuracy-percent">0.00</span>%
            </div>
            <div id="score-board" class="info-item">
                ç­”å°ï¼š<span id="score">0</span> | ç­”éŒ¯ï¼š<span id="wrong-count">0</span>
            </div>
        </div>
        
        <div id="result-details" style="display: none;"></div>
        
    </div>

    <script>
        // JavaScript ç¨‹å¼ç¢¼
        const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const lowercase = 'abcdefghijklmnopqrstuvwxyz';
        const symbols = '1234567890!@#$%^&*()';
        
        const targetLetterBox = document.getElementById('target-letter-box');
        const targetLetterElement = document.getElementById('target-letter');
        const messageBoard = document.getElementById('message-board');
        const scoreElement = document.getElementById('score');
        const wrongCountElement = document.getElementById('wrong-count');
        const totalCountElement = document.getElementById('total-count');
        const accuracyPercentElement = document.getElementById('accuracy-percent');
        const timerElement = document.getElementById('timer');
        const startButton = document.getElementById('start-button');
        const stopButton = document.getElementById('stop-button');
        const challengeTimeSelect = document.getElementById('challenge-time');
        const infoBoard = document.querySelector('.info-board');
        const resultDetails = document.getElementById('result-details');
        const perfectStar = document.getElementById('perfect-star');
        
        const includeUppercase = document.getElementById('include-uppercase');
        const includeLowercase = document.getElementById('include-lowercase');
        const includeSymbols = document.getElementById('include-symbols');
        const flashOverlay = document.getElementById('flash-overlay');
        
        
        let availableChars = '';
        let currentTarget = '';
        let score = 0;
        let wrongCount = 0;
        let totalAnswered = 0;
        let startTime = 0; 
        let initialTime = 0; 
        let timeLeft = 0;
        let timerInterval = null;
        let gameActive = false;

        // --- è¦–è¦ºç‰¹æ•ˆå‡½æ•¸ (ä¿ç•™) ---
        function applyCorrectEffect() {
            targetLetterBox.classList.add('sparkle-effect');
            flashOverlay.classList.add('correct-flash');
            
            setTimeout(() => {
                targetLetterBox.classList.remove('sparkle-effect');
            }, 300);
            
            setTimeout(() => {
                flashOverlay.classList.remove('correct-flash');
            }, 150);
        }

        function applyWrongEffect() {
            targetLetterBox.classList.add('shake-effect');
            flashOverlay.classList.add('wrong-flash');
            
            setTimeout(() => {
                targetLetterBox.classList.remove('shake-effect');
            }, 200);
            
            setTimeout(() => {
                flashOverlay.classList.remove('wrong-flash');
            }, 150);
        }

        // --- çå‹µæ˜Ÿè™Ÿè¨ˆç®—å‡½æ•¸ ---
        function getStarReward(correct, total) {
            if (total === 0) return { stars: 'â˜†â˜†â˜†', isPerfect: false, percentage: 0 };
            
            const accuracy = correct / total;
            const percentage = (accuracy * 100).toFixed(2);
            let stars = '';
            let isPerfect = false;

            // ä¿®æ­£ï¼š90% ä»¥ä¸Š 2.5 é¡†æ˜Ÿï¼Œ95% ä»¥ä¸Š 3 é¡†æ˜Ÿ
            if (accuracy >= 0.95) {
                stars = 'â­â­â­';
                isPerfect = (correct === total);
            } else if (accuracy >= 0.90) {
                // ç”¨ç¬¦è™Ÿé›£ä»¥è¡¨é” 2.5 é¡†æ˜Ÿï¼Œç‚ºäº†ç¾è§€ï¼Œæˆ‘å€‘çµ¦äºˆ 3 é¡†æ˜Ÿï¼Œä½†å…¨å°æ™‚æ‰çµ¦å¤§æ˜Ÿé¼“å‹µ
                stars = 'â­â­â­'; 
            } else if (accuracy >= 0.60) {
                stars = 'â­â­';
            } else if (accuracy >= 0.30) {
                stars = 'â­';
            } else {
                stars = 'â˜†â˜†â˜†';
            }
            
            return { stars: stars, isPerfect: isPerfect, percentage: percentage };
        }
        
        // æ ¼å¼åŒ–æ™‚é–“ (ç§’ -> åˆ†:ç§’)
        function formatTime(seconds) {
            if (seconds < 0) seconds = 0; // é˜²æ­¢è² æ•¸æ™‚é–“é¡¯ç¤º
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const paddedSeconds = remainingSeconds < 10 ? '0' + remainingSeconds : remainingSeconds;
            return `${minutes}:${paddedSeconds}`;
        }
        
        // æ›´æ–°åˆ†æ•¸æ¿æ•¸æ“š
        function updateScoreboard() {
            scoreElement.textContent = score;
            wrongCountElement.textContent = wrongCount;
            totalAnswered = score + wrongCount;
            totalCountElement.textContent = totalAnswered;
            
            const accuracy = totalAnswered > 0 ? (score / totalAnswered * 100).toFixed(2) : '0.00';
            accuracyPercentElement.textContent = accuracy;
        }

        // æ ¹æ“šå‹¾é¸æ¡†è¨­å®šå¯ç”¨çš„å­—å…ƒé›† (ä¿ç•™)
        function updateAvailableChars() {
            availableChars = '';
            if (includeUppercase.checked) {
                availableChars += uppercase;
            }
            if (includeLowercase.checked) {
                availableChars += lowercase;
            }
            if (includeSymbols.checked) {
                availableChars += symbols;
            }
            if (availableChars.length === 0) {
                 availableChars = uppercase;
                 includeUppercase.checked = true;
                 alert("è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®å­—å…ƒé¡å‹ï¼å·²è‡ªå‹•å‹¾é¸ã€Œå­—æ¯å¤§å¯«ã€ã€‚");
            }
        }

        // éš¨æ©Ÿé¸å‡ºä¸‹ä¸€å€‹ç›®æ¨™å­—å…ƒ
        function setNextTarget() {
            if (!gameActive) return;
            
            updateAvailableChars();
            const randomIndex = Math.floor(Math.random() * availableChars.length);
            currentTarget = availableChars[randomIndex];
            targetLetterElement.textContent = currentTarget;
            messageBoard.textContent = ''; 
            messageBoard.className = ''; 
        }

        // é–‹å§‹è¨ˆæ™‚å™¨
        function startTimer() {
            clearInterval(timerInterval);
            startTime = Date.now(); 
            
            if (initialTime > 0) {
                // å€’æ•¸è¨ˆæ™‚æ¨¡å¼
                timerElement.textContent = formatTime(timeLeft);
                timerInterval = setInterval(() => {
                    timeLeft--;
                    timerElement.textContent = formatTime(timeLeft);
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            } else {
                 // ä¸é™æ™‚æ¨¡å¼ï¼Œé¡¯ç¤ºç´¯è¨ˆæ™‚é–“
                let elapsed = 0;
                timerElement.textContent = formatTime(elapsed);
                timerInterval = setInterval(() => {
                    elapsed = Math.floor((Date.now() - startTime) / 1000);
                    timerElement.textContent = formatTime(elapsed);
                }, 1000);
            }
        }

        // éŠæˆ²çµæŸ
        function endGame() {
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“çµæŸï¼Œé¿å…é‡è¤‡åŸ·è¡Œ
            if (!gameActive && targetLetterElement.textContent === 'END') return; 
            
            gameActive = false;
            clearInterval(timerInterval);
            
            document.removeEventListener('keydown', handleKeyDown);

            // è¨ˆç®—ç¸½ç”¨æ™‚ (ç§’)
            const totalDuration = (initialTime > 0) 
                ? initialTime 
                : Math.floor((Date.now() - startTime) / 1000);
            
            // é¿å…é™¤ä»¥é›¶
            const durationInMinutes = totalDuration / 60 || 1 / 60; // è‡³å°‘ç”¨ 1 ç§’ä¾†è¨ˆç®—é€Ÿåº¦
            
            // è¨ˆç®—æ˜Ÿç´šå’Œç™¾åˆ†æ¯”
            const reward = getStarReward(score, totalAnswered);
            
            // è¨ˆç®—ä½œç­”é€Ÿåº¦
            const grossCPM = Math.round(totalAnswered / durationInMinutes);
            const netCPM = Math.round(score / durationInMinutes); 
            const netWPM = Math.round(netCPM / 5); 

            targetLetterElement.textContent = 'END';
            
            // é¡¯ç¤ºæœ€çµ‚åˆ†æ•¸å’Œæ˜Ÿç´š
            messageBoard.innerHTML = `
                <div class="end-message">æŒ‘æˆ°çµæŸï¼</div>
                <div id="star-rewards">${reward.stars}</div>
            `;
            
            // é¡¯ç¤ºè©³ç´°çµæœ
            resultDetails.innerHTML = `
                <div class="result-detail">
                    <strong>ğŸ“Š çµ±è¨ˆçµæœ</strong><br>
                    â–¸ ç¸½ä½œç­”é¡Œæ•¸: ${totalAnswered} (å° ${score} æ¬¡ / éŒ¯ ${wrongCount} æ¬¡)<br>
                    â–¸ ç­”é¡Œæº–ç¢ºç‡: <strong>${reward.percentage}%</strong><br>
                    â–¸ ç¸½èŠ±è²»æ™‚é–“: ${formatTime(totalDuration)}<br>
                    <br>
                    <strong>ğŸš€ ä½œç­”é€Ÿåº¦</strong><br>
                    â–¸ æ¯åˆ†é˜ä½œç­”é¡Œæ•¸ (CPM): <strong>${grossCPM}</strong><br>
                    â–¸ æº–ç¢ºæ‰“å­—é€Ÿåº¦ (WPM): <strong>${netWPM}</strong> (æ·¨å­—/åˆ†é˜)<br>
                </div>
            `;
            resultDetails.style.display = 'block';

            // è™•ç†å…¨å°çå‹µ
            if (reward.isPerfect && score > 0) {
                perfectStar.classList.add('show-perfect');
            }

            // é‡ç½®æŒ‰éˆ•
            startButton.textContent = 'é‡æ–°é–‹å§‹';
            startButton.style.display = 'block';
            startButton.disabled = false;
            stopButton.style.display = 'none';

            // é‡æ–°å•Ÿç”¨æ§åˆ¶é …
            challengeTimeSelect.disabled = false;
            includeUppercase.disabled = false;
            includeLowercase.disabled = false;
            includeSymbols.disabled = false;
        }

        // éµç›¤äº‹ä»¶è™•ç†å‡½æ•¸
        function handleKeyDown(event) {
            if (!gameActive) return;
            
            if (event.key.length > 1 && event.key !== ' ') return; 

            const pressedKey = event.key; 

            if (availableChars.includes(pressedKey)) {
                if (pressedKey === currentTarget) {
                    // âœ… ç­”å°äº†ï¼
                    score++;
                    applyCorrectEffect();
                    messageBoard.textContent = 'ğŸŒŸ å¤ªæ£’äº†ï¼æ˜¯æ­£ç¢ºçš„å­—å…ƒï¼ğŸ‰';
                    messageBoard.className = 'correct';
                    setTimeout(setNextTarget, 100); 
                } else {
                    // âŒ ç­”éŒ¯äº†ï¼
                    wrongCount++;
                    applyWrongEffect();
                    messageBoard.textContent = `å“å‘€ï¼Œä½ æŒ‰äº† ${pressedKey}ã€‚è«‹è©¦è©¦ ${currentTarget} å”·ï¼ğŸ¥º`;
                    messageBoard.className = 'wrong';
                }
            } else {
                 if (event.key.match(/^[a-zA-Z0-9!@#$%^&*()]$/)) {
                     applyWrongEffect();
                     messageBoard.textContent = `è«‹å°ˆå¿ƒçœ‹è¦æŒ‰çš„å­—å…ƒå”·ï¼`;
                     messageBoard.className = 'wrong';
                 }
            }
            
            updateScoreboard(); // å¯¦æ™‚æ›´æ–°æ‰€æœ‰æ•¸æ“š
        }

        // éŠæˆ²åˆå§‹åŒ–/é‡ç½®
        function startGame() {
            // ä¿®æ­£ï¼šåœ¨é–‹å§‹å‰å…ˆç¢ºä¿æ²’æœ‰è¨ˆæ™‚å™¨åœ¨è·‘
            clearInterval(timerInterval); 
            
            if (gameActive) return;

            initialTime = parseInt(challengeTimeSelect.value);
            timeLeft = initialTime; // ä¿®æ­£ï¼šç¢ºä¿ timeLeft åˆå§‹åŒ–æ­£ç¢º
            
            score = 0;
            wrongCount = 0;
            totalAnswered = 0;
            gameActive = true;
            
            // æ¸…ç†ä»‹é¢
            perfectStar.classList.remove('show-perfect');
            resultDetails.style.display = 'none';
            
            updateScoreboard(); 
            messageBoard.textContent = 'GO! GO! GO!';
            
            // éš±è—/é¡¯ç¤ºæŒ‰éˆ•
            startButton.style.display = 'none';
            stopButton.style.display = 'block';

            // ç¦ç”¨æ§åˆ¶é …
            challengeTimeSelect.disabled = true;
            includeUppercase.disabled = true;
            includeLowercase.disabled = true;
            includeSymbols.disabled = true;

            updateAvailableChars();
            setNextTarget();
            startTimer();
            
            document.addEventListener('keydown', handleKeyDown);
        }

        // åˆå§‹è¨­å®š
        document.addEventListener('DOMContentLoaded', () => {
            targetLetterElement.textContent = 'æº–å‚™';
            updateAvailableChars(); 
            // ä¿®æ­£ï¼šåˆå§‹æ™‚é¡¯ç¤ºé¸å–®è¨­å®šçš„æ™‚é–“ï¼Œè€Œé '0'
            timerElement.textContent = formatTime(parseInt(challengeTimeSelect.value)); 
            updateScoreboard();
        });
        
        // é–‹å§‹æŒ‰éˆ•äº‹ä»¶
        startButton.addEventListener('click', startGame);
        
        // åœæ­¢æŒ‰éˆ•äº‹ä»¶
        stopButton.addEventListener('click', endGame);
        
        // æ”¹è®Šæ™‚é–“é¸é …æ™‚ï¼Œæ›´æ–°é¡¯ç¤ºçš„æ™‚é–“
        challengeTimeSelect.addEventListener('change', () => {
             const selectedTime = parseInt(challengeTimeSelect.value);
             if (!gameActive) {
                timerElement.textContent = formatTime(selectedTime);
             }
        });

    </script>

</body>
</html>

